<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width,height=device-height, user-scalable=no,initial-scale=1, minimum-scale=1, maximum-scale=1,target-densitydpi=device-dpi">
<title>文本被选中</title>
<style type = "text/css">
 #showSelected{
 margin:100px auto;
 width:100%;
 height:200px;
 background:#ececec;
 border:1px solid #ccc;
 }

 .span {
 	border-bottom: 1px solid red;
 }

 .note {
  width: 100px;
  height: 100px;
  position: relative;
  right: 10px;
  bottom: 10px;
  background-color: red;
  display: none;
 }

</style>
<script type = "text/javascript">
//传入要获取其中选择文本的对象
function getSelectedText(e){
  //IE下获取选择文本
  if (document.selection) {
   return document.selection.createRange().text;
  }
  //firefox下获取选择文本
  else
   if (window.getSelection().toString()) {
   	console.log(window.getSelection())
    return window.getSelection().toString();
   }
   //firefox下获取input或textArea域的选择文本
   else
    if (e.selectionStart != undefined && e.selectionEnd != undefined) {
     var start = e.selectionStart;
     var end = e.selectionEnd;
     return e.value.substring(start, end);
    }
}

var currentText = ''

document.onmouseup = function(){
  var ta = document.getElementById("myDiv");
  var selectedText = getSelectedText(document.body);
  if (selectedText !== undefined) {
        currentText = selectedText
        document.getElementById("textText").innerHTML = currentText
        document.getElementById("note").style.display = "block"
  }else {
        currentText = ''
        document.getElementById("note").style.display = "none"
  }
  //document.getElementById("showSelected").innerHTML = getSelectedText(document.body);
}

document.addEventListener('touchend',touchend, false);
document.addEventListener('touchmove',touchend, false);

function touchend() {
  var ta = document.getElementById("myDiv");
  var selectedText = getSelectedText(document.body);
  if (selectedText !== undefined) {
        currentText = selectedText
        document.getElementById("textText").innerHTML = currentText
  }else {
        currentText = ''
  }
  //document.getElementById("showSelected").innerHTML = getSelectedText(document.body);
}

document.addEventListener('touchstart',touchstart, false);

function touchstart() {
	document.getElementById("textText").innerHTML = ""
  //document.getElementById("showSelected").innerHTML = getSelectedText(document.body);
}

</script>
</head>
  <body>
    <div id="myDiv">
        北凉王府龙盘虎踞于清凉山，千门万户，极土木之盛。

        作为王朝硕果仅存的异姓王，在庙堂和江湖都是毁誉参半的北凉王徐骁作为一名功勋武臣，可谓得到了皇帝宝座以外所有的东西，在西北三州，他就是当之无愧的主宰，只手遮天，翻云覆雨。
    
        难怪朝廷中与这位异姓王政见不合的大人们私下都会文绉绉骂一声徐蛮子，而一些居心叵测的，更诛心地丢了顶“二皇帝”的帽子。
    
        今天王府很热闹，位高权重的北凉王亲自开了中门，摆开辉煌仪仗，迎接一位仙风道骨的老者，府中下人们只听说是来自道教圣地龙虎山的神仙，相中了痴痴傻傻的小王爷，要收作闭关弟子，这可是天大的福缘，北凉王府都解释成傻人有傻福。
    
        可不是，小王爷自打出生起便没哭过，读书识字一窍不通，六岁才会说话，名字倒是威武气派，徐龙象，传闻还是龙虎山的老神仙当年给取的，说好十二年后再来收徒，这不就如约而至了。
    
        王府内一处院落，龙虎山师祖一级的道门老祖宗捻着一缕雪白胡须，眉头紧皱，背负一柄不常见的小钟馗式桃木剑，配合他的相貌，确实当得出尘二字，谁看都要由衷赞一声世外高人呐。
    
        但此番收徒显然遇到了不小的阻碍，倒不是王府方面有异议，而是他的未来徒弟犟脾气上来了，蹲在一株梨树下，用屁股对付他这个天下道统中论地位能排前三甲的便宜师傅，至于武功嘛，咳咳，前三十总该有的吧。
    
        连堂堂大柱国北凉王都得蹲在那里好言相劝，循循善诱里透着股诱拐，“儿子，去龙虎山学成一身本事，以后谁再敢说你傻，你就揍他，三品以下的文官武将，打死都不怕，爹给你撑腰。”
    
        “儿啊，你力气大，不学武捞个天下十大高手当当就太可惜了。学成归来，爹就给你一个上骑都尉当当，骑五花马，批重甲，多气派。”
    
        小王爷完全不搭理，死死盯着地面，瞧得津津有味。
    
        “黄蛮儿，你不是喜欢吃糖葫芦吗，那龙虎山遍地的野山楂，你随便摘随便啃。赵天师，是不是？”
    
        老神仙硬挤出一抹笑容，连连点头称是。收徒弟收到这份上，也忒寒碜了，说出去还不被全天下笑话。
    
        可哪怕位于堂堂超一品官职、在十二郡一言九鼎的大柱国口干舌燥了，少年还是没什么反应，估计是不耐烦了嫌老爹说得呱噪，翘起屁股，噗一下来了个响屁，还不忘扭头对老爹咧嘴一笑。
    
        把北凉王给气得抬手作势要打，可抬着手僵持一会儿，就作罢。一来是不舍得打，二来是打了没意义。
    
        这儿子可真对得起名字，徐龙象，取自“水行中龙力最大，陆行中象力第一，威猛如金刚，是谓龙象”，别看绰号黄蛮儿的傻儿子憨憨笨笨，至今斗大字不识，皮肤病态的暗黄，身形比较同龄人都要瘦弱，但这气力，却是一等一骇人。
    
    </div>

    <button onclick="copy()">复制</button>
    <button onclick="line()">划线</button>
    <div id="textText"></div>
    <button class="note" id="note" onclick="show()">做笔记</button>

  </body>

  <script>
  			
  			function test() {
  				alert(123);
  			}
  	

          function copy() {
                document.execCommand('copy');
          }

          function show() {
            alert(window.getSelection().toString())
          }

          function line() {
          		var sel = window.getSelection()
          		console.log(sel)
          		//console.log(sel.focusNode.localName)
          		console.log(sel.focusNode.parentNode.className)
          		if (sel.focusNode.parentNode.className == 'span') {
          			alert('已经划过了')
          			return;
          		}
          		var span = document.createElement("span");
          		span.className = "span"
          		span.onclick = function() {
          			test()
          		}
          		window.getSelection().getRangeAt(0).surroundContents(span);
                // var myDiv = document.getElementById('myDiv');
                // var html = myDiv.innerHTML;
                // html = html.replace(currentText, '<a href="">'+ currentText +'</a>');
                // myDiv.innerHTML = html;
          }
  </script>
</html>
